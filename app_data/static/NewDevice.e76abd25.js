import{b4 as ke,b5 as Ce,a6 as z,u as Se,b6 as re,b7 as le,o as c,c as C,a2 as H,a4 as j,O as S,a1 as Y,_,w as f,h as N,b8 as G,i as de,z as P,l as q,H as K,b as s,d as W,a as l,af as M,ag as X,g as J,s as we,b9 as Re,ba as Fe,aU as Ie,aP as Pe,W as Ne,t as Ue,v as Be,j as ue,bb as xe,bc as Ae,y as Oe,X as $e,aY as Le,a_ as Te,D as oe,a9 as ze,E as De,b2 as Ee,F as Me,m as $,G as Je,S as je,M as He,k as I,bd as ie,r as Ye,aN as se,aB as Ge,ay as D,aK as E}from"./index.0b5359b1.js";import{h as A,i as qe,j as Ke,k as We,l as Xe,a as Qe,n as Ze,f as et,o as tt,p as at,g as nt,q as lt,b as ot}from"./VRadioGroup.0349e3fe.js";var O=(e=>(e[e.None=0]="None",e[e.Connect=1]="Connect",e[e.Configure=2]="Configure",e[e.Done=3]="Done",e))(O||{});const Q=ke("new_device",{state:()=>({error_msgs:new Array,show_error:!1,show_error_timeout:null,err_clr_timeout:null,device_id:0,init_state:0,is_idle:!0,device_name:"",module_file:new Array,conn_conf_info:new Array,conn_conf:new Map,device_conf_info:new Array,device_conf:new Map}),getters:{start_init_available:e=>e.device_name.length>0&&e.module_file.length==1},actions:{handle_error(e){this.handle_error_raw("["+e.code+"] "+e.msg)},handle_error_raw(e){this.show_error_timeout&&clearTimeout(this.show_error_timeout),this.err_clr_timeout&&clearTimeout(this.err_clr_timeout),this.error_msgs.push(e),this.show_error=!0,this.show_error_timeout=setTimeout(()=>{this.handle_error_close(!1)},5e3)},handle_error_close(e){e||(this.show_error=!1,this.err_clr_timeout=setTimeout(()=>{this.error_msgs=[]},1e3))},async with_error_handling(e){try{await e()}catch(a){a instanceof Ce?a.data.msg&&a.data.code?this.handle_error(a.data):this.handle_error_raw("["+a.status+"] "+a.data.toString()):this.handle_error_raw("[unknown] "+(a==null?void 0:a.toString()))}},assign_conf(e,a){a.forEach(t=>{if(t.id==0&&t.data.Section){this.assign_conf(e,t.data.Section);return}let o=(()=>t.data.String?{String:t.data.String.default?t.data.String.default:""}:t.data.Int?{Int:t.data.Int.default?t.data.Int.default:0}:t.data.IntRange?{IntRange:[t.data.IntRange.def_from!=null?t.data.IntRange.def_from:t.data.IntRange.min,t.data.IntRange.def_to?t.data.IntRange.def_to:t.data.IntRange.max]}:t.data.Float?{Float:t.data.Float.default?t.data.Float.default:0}:t.data.FloatRange?{FloatRange:[t.data.FloatRange.def_from!=null?t.data.FloatRange.def_from:t.data.FloatRange.min,t.data.FloatRange.def_to?t.data.FloatRange.def_to:t.data.FloatRange.max]}:t.data.JSON?{JSON:t.data.JSON.default?t.data.JSON.default:""}:t.data.ChoiceList?{ChoiceList:t.data.ChoiceList.default?t.data.ChoiceList.default:0}:{String:"INVALID_TYPE"})();e.set(t.id,o)})},conf_array_from_map(e){let a=new Array;for(const[t,o]of e)a.push({id:t,data:o});return a},async start_device_init(){this.is_idle=!1;try{const[e,a]=await z.start_device_init(this.device_name,this.module_file[0]);if(!a)this.handle_error(e);else{let t=e;this.device_id=t.device_id,this.conn_conf_info=t.conn_params,this.assign_conf(this.conn_conf,t.conn_params),this.init_state=1}}catch(e){this.handle_error_raw(e.toString())}this.is_idle=!0},async connect_device(){this.is_idle=!1,await this.with_error_handling(async()=>{let e=this.conf_array_from_map(this.device_conf);await z.connect_device({device_id:this.device_id,connect_conf:e});const a=await z.obtain_device_conf_info({device_id:this.device_id});this.device_conf_info=a.data.device_conf_info,this.assign_conf(this.device_conf,this.device_conf_info),this.init_state=2}),this.is_idle=!0},async configure_device(){this.is_idle=!1,await this.with_error_handling(async()=>{let e=this.conf_array_from_map(this.device_conf);await z.configure_device({device_id:this.device_id,confs:e}),this.init_state=3,Se().add_device(this.device_id,this.device_name)}),this.is_idle=!0}}}),it={name:"ConfigureSection",props:{name:String,conf_info:Object,modelValue:Object},emits:["update:modelValue"]},st={key:0};function rt(e,a,t,o,i,h){const u=le("RangePicker"),V=le("ConfigureSection",!0);return c(),C(S,null,[t.name?(c(),C("h2",st,H(t.name),1)):j("",!0),(c(!0),C(S,null,Y(t.conf_info,(n,m)=>(c(),_(G,{key:m},{default:f(()=>[n.data.String?(c(),_(A,{key:0,label:n.name,modelValue:t.modelValue.get(n.id).String,"onUpdate:modelValue":r=>t.modelValue.get(n.id).String=r},null,8,["label","modelValue","onUpdate:modelValue"])):n.data.Int?(c(),_(A,{key:1,label:n.name,type:"number",modelValue:t.modelValue.get(n.id).Int,"onUpdate:modelValue":r=>t.modelValue.get(n.id).Int=r,modelModifiers:{number:!0}},null,8,["label","modelValue","onUpdate:modelValue"])):n.data.IntRange?(c(),_(u,{key:2,modelValue:t.modelValue.get(n.id).IntRange,"onUpdate:modelValue":r=>t.modelValue.get(n.id).IntRange=r,label:n.name,step:1,min:n.data.IntRange.min,max:n.data.IntRange.max},null,8,["modelValue","onUpdate:modelValue","label","min","max"])):n.data.Float?(c(),_(A,{key:3,label:n.name,type:"number",modelValue:t.modelValue.get(n.id).Float,"onUpdate:modelValue":r=>t.modelValue.get(n.id).Float=r,modelModifiers:{number:!0}},null,8,["label","modelValue","onUpdate:modelValue"])):n.data.FloatRange?(c(),_(u,{key:4,modelValue:t.modelValue.get(n.id).FloatRange,"onUpdate:modelValue":r=>t.modelValue.get(n.id).FloatRange=r,label:n.name,step:.001,min:n.data.FloatRange.min,max:n.data.FloatRange.max},null,8,["modelValue","onUpdate:modelValue","label","step","min","max"])):j("",!0),n.data.JSON?(c(),_(A,{key:5,label:n.name,modelValue:t.modelValue.get(n.id).JSON,"onUpdate:modelValue":r=>t.modelValue.get(n.id).JSON=r},null,8,["label","modelValue","onUpdate:modelValue"])):n.data.ChoiceList?(c(),_(qe,{key:6,modelValue:t.modelValue.get(n.id).ChoiceList,"onUpdate:modelValue":r=>t.modelValue.get(n.id).ChoiceList=r,modelModifiers:{number:!0}},{default:f(()=>[N("p",null,H(n.name),1),(c(!0),C(S,null,Y(n.data.ChoiceList.choices,(r,k)=>(c(),_(Ke,{key:k,label:r,value:k},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):n.data.Section?(c(),_(V,{key:7,conf_info:n.data.Section,name:n.name},null,8,["conf_info","name"])):j("",!0)]),_:2},1024))),128))],64)}const ce=re(it,[["render",rt]]),Z=de({name:"VForm",props:{...We()},emits:{"update:modelValue":e=>!0,submit:e=>!0},setup(e,a){let{slots:t,emit:o}=a;const i=Xe(e),h=P();function u(n){n.preventDefault(),i.reset()}function V(n){const m=n,r=i.validate();m.then=r.then.bind(r),m.catch=r.catch.bind(r),m.finally=r.finally.bind(r),o("submit",m),m.defaultPrevented||r.then(k=>{let{valid:w}=k;if(w){var b;(b=h.value)==null||b.submit()}}),m.preventDefault()}return q(()=>{var n;return s("form",{ref:h,class:"v-form",novalidate:!0,onReset:u,onSubmit:V},[(n=t.default)==null?void 0:n.call(t,i)])}),K(i,h)}}),dt=N("h1",null,"2. Connect to the device",-1),ut=W({__name:"Connect",setup(e){const a=Q();return(t,o)=>(c(),_(Z,{disabled:!l(a).is_idle},{default:f(()=>[s(G,null,{default:f(()=>[dt,s(ce,{conf_info:l(a).conn_conf_info,modelValue:l(a).conn_conf,"onUpdate:modelValue":o[0]||(o[0]=i=>l(a).conn_conf=i)},null,8,["conf_info","modelValue"]),s(M,{loading:!l(a).is_idle,disabled:!l(a).start_init_available||!l(a).is_idle,onClick:o[1]||(o[1]=X(i=>l(a).connect_device(),["stop"]))},{default:f(()=>[J("Connect")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["disabled"]))}}),ct=N("h1",null,"3. Configure device",-1),mt=W({__name:"Configure",setup(e){const a=Q();return(t,o)=>(c(),_(Z,{disabled:!l(a).is_idle},{default:f(()=>[ct,s(ce,{conf_info:l(a).device_conf_info,modelValue:l(a).device_conf,"onUpdate:modelValue":o[0]||(o[0]=i=>l(a).device_conf=i)},null,8,["conf_info","modelValue"]),s(M,{loading:!l(a).is_idle,disabled:!l(a).start_init_available||!l(a).is_idle,onClick:o[1]||(o[1]=X(i=>l(a).configure_device(),["stop"]))},{default:f(()=>[J("Configure")]),_:1},8,["loading","disabled"])]),_:1},8,["disabled"]))}}),ft={name:"ErrorSnack",props:{modelValue:Boolean,msgs:Array},emits:["update:modelValue"]};const _t=we()({name:"VSnackbar",props:{multiLine:Boolean,timeout:{type:[Number,String],default:5e3},vertical:Boolean,...Re({location:"bottom"}),...Fe(),...Ie(),...Pe(),...Ne(),...Ue(Be({transition:"v-snackbar-transition"}),["persistent","noClickAnimation","scrim","scrollStrategy"])},emits:{"update:modelValue":e=>!0},setup(e,a){let{slots:t}=a;const o=ue(e,"modelValue"),{locationStyles:i}=xe(e),{positionClasses:h}=Ae(e),{scopeId:u}=Oe(),{themeClasses:V}=$e(e),{colorClasses:n,colorStyles:m,variantClasses:r}=Le(e),{roundedClasses:k}=Te(e),w=P();oe(o,v),oe(()=>e.timeout,v),ze(()=>{o.value&&v()});let b=-1;function v(){window.clearTimeout(b);const R=Number(e.timeout);!o.value||R===-1||(b=window.setTimeout(()=>{o.value=!1},R))}function p(){window.clearTimeout(b)}return q(()=>{const[R]=De(e);return s(Je,$({ref:w,class:["v-snackbar",{"v-snackbar--active":o.value,"v-snackbar--multi-line":e.multiLine&&!e.vertical,"v-snackbar--vertical":e.vertical},h.value]},R,{modelValue:o.value,"onUpdate:modelValue":U=>o.value=U,contentProps:$({style:i.value},R.contentProps),persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none"},u),{default:()=>[s("div",{class:["v-snackbar__wrapper",V.value,n.value,k.value,r.value],style:[m.value],onPointerenter:p,onPointerleave:v},[Ee(!1,"v-snackbar"),t.default&&s("div",{class:"v-snackbar__content",role:"status","aria-live":"polite"},[t.default()]),t.actions&&s(Me,{defaults:{VBtn:{variant:"text",ripple:!1}}},{default:()=>[s("div",{class:"v-snackbar__actions"},[t.actions()])]})])],activator:t.activator})}),K({},w)}}),vt={style:{"text-align":"center"}};function gt(e,a,t,o,i,h){return c(),C("div",vt,[s(_t,{timeout:-1,modelValue:t.modelValue,"onUpdate:modelValue":a[1]||(a[1]=u=>e.$emit("update:modelValue",u.valueOf())),color:"red-darken-2",timer:!0},{actions:f(()=>[s(M,{text:"",onClick:a[0]||(a[0]=u=>e.$emit("update:modelValue",!1))},{default:f(()=>[J(" Close ")]),_:1})]),default:f(()=>[(c(!0),C(S,null,Y(t.msgs,(u,V)=>(c(),C("ul",{key:V},[N("li",null,H(u),1)]))),128))]),_:1},8,["modelValue"])])}const ht=re(ft,[["render",gt]]);const Vt=de({name:"VFileInput",inheritAttrs:!1,props:{chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,hint:String,persistentHint:Boolean,placeholder:String,showSize:{type:[Boolean,Number],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(e)},...Qe({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:e=>je(e).every(a=>a!=null&&typeof a=="object")},...Ze({clearable:!0})},emits:{"click:control":e=>!0,"update:modelValue":e=>!0},setup(e,a){let{attrs:t,emit:o,slots:i}=a;const{t:h}=He(),u=ue(e,"modelValue"),V=I(()=>typeof e.showSize!="boolean"?e.showSize:void 0),n=I(()=>{var d;return((d=u.value)!=null?d:[]).reduce((g,y)=>{let{size:B=0}=y;return g+B},0)}),m=I(()=>ie(n.value,V.value)),r=I(()=>{var d;return((d=u.value)!=null?d:[]).map(g=>{const{name:y="",size:B=0}=g;return e.showSize?`${y} (${ie(B,V.value)})`:y})}),k=I(()=>{var y;var d;const g=(y=(d=u.value)==null?void 0:d.length)!=null?y:0;return e.showSize?h(e.counterSizeString,g,m.value):h(e.counterString,g)}),w=P(),b=P(),v=P(!1),p=P(),R=I(()=>e.messages.length?e.messages:e.persistentHint?e.hint:"");function U(){if(p.value!==document.activeElement){var d;(d=p.value)==null||d.focus()}v.value||(v.value=!0)}function me(d){se(e["onClick:prepend"],d),ee(d)}function ee(d){var g;(g=p.value)==null||g.click(),o("click:control",d)}function fe(d){d.stopPropagation(),U(),Ge(()=>{u.value=[],p!=null&&p.value&&(p.value.value=""),se(e["onClick:clear"],d)})}return q(()=>{const d=!!(i.counter||e.counter),g=!!(d||i.details),[y,B]=Ye(t),[{modelValue:bt,..._e}]=et(e),[ve]=tt(e);return s(ot,$({ref:w,modelValue:u.value,"onUpdate:modelValue":x=>u.value=x,class:"v-file-input","onClick:prepend":me,"onClick:append":e["onClick:append"]},y,_e,{focused:v.value,messages:R.value}),{...i,default:x=>{let{id:L,isDisabled:T,isDirty:te,isReadonly:ge,isValid:he}=x;return s(at,$({ref:b,"prepend-icon":e.prependIcon,"onClick:control":ee,"onClick:clear":fe,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},ve,{id:L.value,active:te.value||v.value,dirty:te.value,focused:v.value,error:he.value===!1}),{...i,default:Ve=>{var ae;let{props:{class:pe,...be}}=Ve;return s(S,null,[s("input",$({ref:p,type:"file",readonly:ge.value,disabled:T.value,multiple:e.multiple,name:e.name,onClick:F=>{F.stopPropagation(),U()},onChange:F=>{var ne;if(!F.target)return;const ye=F.target;u.value=[...(ne=ye.files)!=null?ne:[]]},onFocus:U,onBlur:()=>v.value=!1},be,B),null),s("div",{class:pe},[!!((ae=u.value)!=null&&ae.length)&&(i.selection?i.selection({fileNames:r.value,totalBytes:n.value,totalBytesReadable:m.value}):e.chips?r.value.map(F=>s(nt,{key:F,size:"small",color:e.color},{default:()=>[F]})):r.value.join(", "))])])}})},details:g?x=>{var L,T;return s(S,null,[(L=i.details)==null?void 0:L.call(i,x),d&&s(S,null,[s("span",null,null),s(lt,{active:!!((T=u.value)!=null&&T.length),value:k.value},i.counter)])])}:void 0})}),K({},w,b,p)}}),pt=N("h1",null,"1. Start initialization",-1),Ct=W({__name:"NewDevice",setup(e){const a=Q();return(t,o)=>(c(),C(S,null,[s(ht,{modelValue:l(a).show_error,"onUpdate:modelValue":o[0]||(o[0]=i=>l(a).handle_error_close(i.valueOf())),msgs:l(a).error_msgs},null,8,["modelValue","msgs"]),D(s(Z,{disabled:!l(a).is_idle},{default:f(()=>[s(G,null,{default:f(()=>[pt,s(A,{label:"Device name",modelValue:l(a).device_name,"onUpdate:modelValue":o[1]||(o[1]=i=>l(a).device_name=i),active:l(a).is_idle},null,8,["modelValue","active"]),s(Vt,{label:"Device's module file",modelValue:l(a).module_file,"onUpdate:modelValue":o[2]||(o[2]=i=>l(a).module_file=i)},null,8,["modelValue"]),s(M,{loading:!l(a).is_idle,disabled:!l(a).start_init_available||!l(a).is_idle,onClick:o[3]||(o[3]=X(i=>l(a).start_device_init(),["stop"]))},{default:f(()=>[J("Start Init")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["disabled"]),[[E,l(a).init_state==l(O).None]]),D(s(ut,null,null,512),[[E,l(a).init_state==l(O).Connect]]),D(s(mt,null,null,512),[[E,l(a).init_state==l(O).Configure]]),D(N("h1",null," You're all set! ",512),[[E,l(a).init_state==l(O).Done]])],64))}});export{Ct as default};
